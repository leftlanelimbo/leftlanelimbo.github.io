<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>perspective_tilt</title>
    <style>
        body{
            background-color: black;
            perspective: 1000px;
            perspective-origin: 50% 50%;
            /* margin: 0; */
            overflow: hidden;
        }
        img{
            max-width: 100%;
        }
        #wrapper{
        position:absolute;
        display:block;
        margin-left:auto;
        margin-right:auto;
        transform: rotateY(0deg);
        top: 10vh; 
        left: 8vh;
        width:50%;
        }
        /* #wrapper:hover{
        transform: rotateY(20deg);
        } */
        #xval {
        position: absolute;
        top: 10px;
        /* width: 100vw; */
        /* height: 100vh; */
        text-align: left;
        z-index: 150;
        display:block;
        color:white;
        }
        #yval {
        position: absolute;
        top: 30px;
        /* width: 100vw; */
        /* height: 80vh; */
        text-align: left;
        z-index: 150;
        display:block;
        color: white;
        }
        #zval {
        position: absolute;
        top: 50px;
        /* width: 100vw; */
        /* height: 80vh; */
        text-align: left;
        z-index: 150;
        display:block;
        color: white;
        }
        #alpha {
        position: absolute;
        top: 70px;
        /* width: 100vw; */
        /* height: 80vh; */
        text-align: left;
        z-index: 150;
        display:block;
        color: white;
        }
        #beta {
        position: absolute;
        top: 90px;
        /* width: 100vw; */
        /* height: 80vh; */
        text-align: left;
        z-index: 150;
        display:block;
        color: white;
        }
        #gamma {
        position: absolute;
        top: 110px;
        /* width: 100vw; */
        /* height: 80vh; */
        text-align: left;
        z-index: 150;
        display:block;
        color: white;
        }

        #Oalpha {
        position: absolute;
        top: 150px;
        /* width: 100vw; */
        /* height: 80vh; */
        text-align: left;
        z-index: 150;
        display:block;
        color: white;
        }
        #Obeta {
        position: absolute;
        top: 170px;
        /* width: 100vw; */
        /* height: 80vh; */
        text-align: left;
        z-index: 150;
        display:block;
        color: white;
        }
        #Ogamma {
        position: absolute;
        top: 190px;
        /* width: 100vw; */
        /* height: 80vh; */
        text-align: left;
        z-index: 150;
        display:block;
        color: white;
        }

        #enter{
        z-index:150;
        }


    </style>
</head>
<body>
    <p id='xval'>xval</p>
    <p id='yval'>yval</p>
    <p id='zval'>zval</p>

    <p id='alpha'>alpha</p>
    <p id='beta'>beta</p>
    <p id='gamma'>gamma</p>

    <p id='Oalpha'>oalpha</p>
    <p id='Obeta'>obeta</p>
    <p id='Ogamma'>ogamma</p>

    <div id="wrapper">
        <img src='https://images.unsplash.com/photo-1579225922986-3f8226580045?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=2134&q=80'>
    </div>

    <button id=enter>Click me</button>




    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.0.4/gsap.min.js"></script>

    <script>
        let x_merge, y_merge;
        let sX = 0.0;
        let sY = 0.0;
        let sB = 20.0; // need to intialize to value you want it to start close to 
        let sA = 50.0;
        let smoothing_factor = 0.8;
        let left_position = 20.0;
        let width = 50.0;

        wrapped = document.getElementById('wrapper');

        function merge_vals(){
            // wrapped.style.transform = `rotateY(${x_merge}deg) rotateX(${y_merge}deg)`;
            // gsap.to('#wrapper',{duration:.25, transform: `rotateY(${x_merge}deg) rotateX(${y_merge}deg)`})
            gsap.to('#wrapper',{duration:.25, rotateY: `${x_merge}deg`})
            gsap.to('#wrapper',{duration:.25, rotateX: `${y_merge}deg`})
        }

        //https://stackoverflow.com/questions/596467/how-do-i-convert-a-float-number-to-a-whole-number-in-javascript
        function float2int(value) {
                return value | 0;
        }

        function handleMotionEvent(event) {
                    // x = Math.abs(event.accelerationIncludingGravity.x * 0.1);
                t = event.acceleration
                x = event.accelerationIncludingGravity.x; //* 0.1;
                y = event.accelerationIncludingGravity.y; //* 0.1;
                z = event.accelerationIncludingGravity.z; //* 0.1;

                a = event.rotationRate.alpha; //* 0.1;
                b = event.rotationRate.beta; //* 0.1;
                g = event.rotationRate.gamma; //* 0.1;

                x_merge = x*10;

                sX = x + smoothing_factor * (sX - x);//,  with 0 <= s <= 1;
                sY = y + smoothing_factor * (sY - y);

                sB = b + smoothing_factor * (sB - b);
                sA = (a + smoothing_factor * (sA - a))*.1;
                // console.log(t);
                //     y = Math.abs(event.accelerationIncludingGravity.y * .05 +.2);
                xval.innerText = `motion event acceleration xval ${sX}`;
                yval.innerText = `motion event acceleration yval ${sY}`;
                zval.innerText = `motion event acceleration zval ${z}`;

                alpha.innerText = `motion event rotationRate alpha ${a}`;
                beta.innerText = `motion event rotationRate beta ${b}`;
                gamma.innerText = `motion event rotationRate gamma ${g}`;
                
                // merge_vals();

                wrapped.style.transform = `rotateY(${-sX*10}deg) rotateX(${-sY*10+20}deg)`;
                

                left_position += sB;
                // wrapped.style.left = '30vw';
                left_space = float2int(left_position*0.04);
                
                wrapped.style.left = `${left_space}vw`;

                width += sA;
                full_width = float2int(width);
                wrapped.style.width = `${full_width}%`;
                // left_position += b*100; 
                // left_position = parseInt(left_position);
                // wrapped.style.left = toString(left_position)+'px';
                // wrapped.style.transform = `rotateY(${x*10}deg)`;
        }
        
        function handleOrientationEvent(event) {
            oA = event.alpha;//* 0.01;
            oB = event.beta;//* 0.01;
            oG = event.gamma;//* 0.01;

            y_merge = oB;
            
            //     y = Math.abs(event.accelerationIncludingGravity.y * .05 +.2);
            Oalpha.innerText = `orientation event alpha ${oA}`;
            Obeta.innerText = `orientation event beta ${oB}`;
            Ogamma.innerText = `orientation event gamma ${oG}`;

            // gsap.to('#wrapper',{duration:.25, rotateY: `${-oG}deg`})
            // wrapped.style.transform = `rotateY(${-oG}deg) rotateX(${-oB+90}deg)`;

            // wrapped.style.transform = `rotateX(${-oB+90}deg)`;
            

        }


        //https://developer.mozilla.org/en-US/docs/Web/API/DeviceMotionEvent
        function onClickDeviceMotion() {
                // feature detect
                if (typeof DeviceMotionEvent.requestPermission === 'function') {
                    DeviceMotionEvent.requestPermission()
                        .then(permissionState => {
                            if (permissionState === 'granted') {
                                window.addEventListener('devicemotion', handleMotionEvent, true);

                            }
                        })
                        .catch(console.error);
                } else {
                    // handle regular non iOS 13+ devices
                    window.addEventListener('devicemotion', handleMotionEvent, true);
                    console.log(console.error);
                }
            }

        function onClickDeviceOrientation() {
            // feature detect
            if (typeof DeviceOrientationEvent.requestPermission === 'function') {
                DeviceOrientationEvent.requestPermission()
                    .then(permissionState => {
                        if (permissionState === 'granted') {
                            window.addEventListener('deviceorientation', handleOrientationEvent, true);

                        }
                    })
                    .catch(console.error);
            } else {
                // handle regular non iOS 13+ devices
                window.addEventListener('deviceorientation', handleOrientationEvent, true);
                console.log(console.error);
            }
        }

        
        document.getElementById('enter').addEventListener("click",onClickDeviceMotion);
        document.getElementById('enter').addEventListener("click",onClickDeviceOrientation);

        
    </script>    
</body>
</html>
